var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{TV:()=>wo,xH:()=>fo,Ly:()=>yo,TY:()=>ho});const n=":tagvar",o=":";function r(t){if(t.startsWith("class."))return"class";const e=function(t){switch(t){case"autoselect":return"autoselect";case"autofocus":return"autofocus"}return!1}(t);return!1!==e?e:!!t.startsWith("style.")&&"style"}const s=new RegExp(n+"(\\d+)"+o,"g");function c(t){return t.search&&t.startsWith(n)?t.search(s):-1}const a=/(:tagvar\d+:)/,u="ondoubleclick",i=/([:_a-zA-Z0-9\-.]+)\s*(?:=\s*"([^"]*)"|=\s*(\S+))?/g,l=/<\/?([a-zA-Z0-9-]+)((?:\s+[a-zA-Z_:*][\w:.-]*(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s"'=<>`]+))?)+\s*|\s*)\/?>/g;const p=new RegExp("(\x3c!--[\\s\\S]*?--\x3e)","g");function f(t,e,n){var o;!function(t,e,n){t?(t.ch||(t.ch=[]),t.ch.push(n)):e.push(n)}(t,e,{nn:"text",tc:(o=n,o.replace(/(\[l t\]!--[\s\S]*?--\[g t\])/g,(function(t){return t.replace(/\[l t\]/g,"<").replace(/\[g t\]/g,">").replace(/\[l&nbsp;t\]/g,"[l t]").replace(/\[g&nbsp;t\]/g,"[g t]")})))})}function g(t){return t.split(a).filter(d)}function d(t){return""!==t}function h(t,e,c,a){const i=t[1]||t[3]||t[5];let l=t[2]||t[4]||t[6];if(void 0===i)return e;const p=""!==t[2],f=void 0===l&&p,g=i.toLowerCase(),d=g.startsWith("on")?(h=g).startsWith("on")?h.length===u.length&&h===u?"dblclick":h.slice(2,h.length):h:g;var h;if(f){if(i.slice(0,n.length)===n){const t=n+ ++e+o;return c.push(["at",t]),a.push([t]),e}if(t[0].startsWith(i)&&t[0].slice(i.length,t[0].length).search(/\s+$/)>=0)return a.push([d]),e;const r=t[3];if(r.search(w)>=0){l=r;const t=[d,l];return a.push(t),e}l=n+ ++e+o}p||(l=t[2]);const m=l.split(b).filter((t=>t.length>0));m.length>1&&(l=m,m.forEach((t=>{t.search(s)>=0&&++e})));const y=[d,l],v=r(g);return v&&y.push(v),"style"===d?(a.unshift(y),e):(a.push(y),e)}const m=new RegExp(n+"(\\d+)"+o,"gi"),b=new RegExp("("+n+"\\d+"+o+")","gi"),y=n.slice(0,n.length-1),w=new RegExp(y+"&#x72;(\\d+)"+o,"gi"),v=y+"&#x72;$1"+o;function x(t,e){const r=function(t,e){return function(t,e){const r=[];for(let s=0;s<t.length;++s){const c=t[s].replace(m,v);s<e.length?r.push(c+n+s+o):r.push(c)}return function(t,e,r){const s=r.length-e.length;if(s>0)for(let r=s;r>0;--r)t.push(n+(e.length+r-1)+o)}(r,t,e),r}(t,e)}(t,e).join("");return function(t){const e=[],r=[],s=[];let c=null,u=-1,d=0;const m=new RegExp(l,"g");for(t=function(t){return t.replace(p,(function(t){return t.replace(/\[l t\]/g,"[l&nbsp;t]").replace(/\[g t\]/g,"[g&nbsp;t]").replace(/</g,"[l t]").replace(/>/g,"[g t]")}))}(t);d<t.length;){const l=m.exec(t);if(!l)break;const[p,b,y]=l,v=p.startsWith("</"),x=p.endsWith("/>");if(d<l.index){const e=t.slice(d,l.index);if(e.trim()){const t=g(e);for(let e of t)e.startsWith(n)&&e.search(a)>=0&&-1===e.search(w)&&(e=n+ ++u+o),f(c,r,e)}}if(d=l.index+p.length,v){c=s.pop()||null;continue}const T=[];let C;for(;null!==(C=i.exec(y));)u=h(C,u,e,T);const k={nn:b};T.length&&(k.at=T),c?(c.ch||(c.ch=[]),c.ch.push(k)):r.push(k),x||(s.push(c),c=k)}if(d<t.length){const e=t.slice(d);if(e.trim()){const t=g(e);for(const e of t)e.startsWith(n)&&++u,f(c,r,e)}}return r}(r)}const T="";var C,k,E;(E=C||(C={})).string="string",E.number="number",E.boolean="boolean",E[void 0]="undefined",function(t){t.function="function",t.date="date",t.unknown="unknown",t.object="object"}(k||(k={}));const S={tag:"html",dom:"dom",templater:"templater",tagComponent:"tagComponent",tagArray:"tagArray",host:"host",subscribe:"subscribe",signal:"signal",renderOnce:"renderOnce",stateRender:"stateRender",version:Date.now()},A="ch";function J(t,e,n=[],o=[]){const r=t;for(let t=0;t<r.length;t++){const s=[...o,t],c=r[t];if(c.at){const t=c.at;c.at=I(t,e)}if(c.ch){const t=c.ch,o=[...s,A];c.ch=J(t,e,n,o)}t=O(c,e,r,t)}return r}function O(t,e,r,c){if("text"!==t.nn)return c;const a=t;let u,i=a.tc;if(typeof i!==C.string)return c;for(;null!==(u=s.exec(i));){const t=u[1],a=parseInt(t,10);if(!isNaN(a)&&a<e){const t=n+a+o,e=i.slice(u.index+t.length);r.splice(c,1,{nn:"text",v:a}),i=e,s.lastIndex=0}}return a.tc=i,c}function I(t,e){const o=[];for(const r of t){const[t,s,c]=r;if(t.startsWith(n)){const r=parseInt(t.replace(n,""),10);if(!isNaN(r)&&r<e){o.push([{tagJsVar:r}]);continue}}if(typeof s===C.string&&s.startsWith(n)){const r=parseInt(s.replace(n,""),10);if(!isNaN(r)&&r<e){o.push([t,{tagJsVar:r},c]);continue}}o.push(r)}return o}function P(t){return t.length}const V={};function j(t,e){const n=function(t){const e=t.map(P);return e.push(t.length),Number(e.join(""))}(t),o=V[n],r=o&&function(t,e,n){return!(!n||n.strings.length!==t.length||!n.strings.every(((e,n)=>e===t[n]))||n.values.length!==e.length)}(t,e,o);if(r)return o.domMetaMap;const s=J(x(t,e),e.length),c={interpolation:void 0,string:void 0,strings:t,values:e,domMetaMap:s};return V[n]=c,s}function M(t,e,n){t.setAttribute(e,"")}function L(t,e,n){void 0!==n&&!1!==n&&null!==n?t.setAttribute(e,n):t.removeAttribute(e)}function N(t,e,n,o){switch(o){case"autofocus":return void Mn.push([H,[n]]);case"autoselect":return void Mn.push([$,[n]]);case"style":{const o=t.split(".");return void Mn.push([R,[n,o,e]])}case"class":return void function(t,e,n){const o=t.split(".");if(o.shift(),e)for(const t of o)Mn.push([W,[n,t]]);else for(const t of o)Mn.push([D,[n,t]])}(t,e,n)}throw new Error(`Invalid special attribute of ${o}. ${t}`)}function R(t,e,n){const o=e[1];t.style[o]=n,t.style.setProperty(o,n)}function W(t,e){t.classList.add(e)}function D(t,e){t.classList.remove(e)}function $(t){t.select()}function H(t){t.focus()}function U(t){if(!t)return!1;switch(t.tagJsType){case S.dom:case S.tag:case S.templater:return!0}return!1}function _(t){const e=t?.tagJsType;return e===S.tagComponent||e===S.stateRender}function B(t){return typeof t===k.function}function F(t){return typeof t===k.object&&null!==t}function G(t){return Array.isArray(t)}function z(t,e){const n=function(t,e,n=[]){const o=t.context;n.push({support:t,renderCount:o.renderCount,provider:e});const r=e.children;for(let t=r.length-1;t>=0;--t){const o=r[t],s=o.context;n.push({support:o,renderCount:s.renderCount,provider:e})}return n}(t,e);return n}function Z(t){return t.support}function q(t,e){return Y(t,e)}function Y(t,e){if(null===t||typeof t!==k.object)return t;if(e<0)return t;if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);const n=G(t)?[]:Object.create(Object.getPrototypeOf(t));if(G(t))for(let o=0;o<t.length;o++)n[o]=Y(t[o],e-1);else for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=Y(t[o],e-1));return n}function K(t,e,n){return Q(t,e,n)}function Q(t,e,n){return!(t!==e&&(o=t,r=e,!B(o)||!B(r)||o.toString()!==r.toString()))||n<0||typeof t===k.object&&typeof e===k.object&&(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():G(t)&&G(e)?function(t,e,n){if(t.length!==e.length)return!1;for(let o=0;o<t.length;o++)if(!Q(t[o],e[o],n-1))return!1;return!0}(t,e,n-1):!G(t)&&!G(e)&&function(t,e,n){const o=Object.keys(t),r=Object.keys(e);if(0===o.length&&0===r.length)return!0;if(o.length!==r.length)return!1;for(const s of o)if(!r.includes(s)||!Q(t[s],e[s],n-1))return!1;return!0}(t,e,n-1));var o,r}function X(t,e){const n=t.length;for(let o=0;o<n;++o){const n=t[o],r=e[o];if(G(n)&&G(r)){if(n===r)continue;return 3}if(typeof n!==k.function||typeof r!==k.function)if(typeof n!==k.object){if(n!==r)return 3.3}else if(typeof e===k.object){const t=Object.entries(n);for(const e of t)if(!tt(e,r))return 3.1}}return!1}function tt([t,e],n){const o=n[t];return typeof e===k.function&&typeof o===k.function||o===e}function et(){return ht.stateConfig.support}function nt(t){return ht.stateConfig.support=t}function ot(t){let e=t;for(;e.ownerSupport&&!_(e.templater);)e=e.ownerSupport;return e.context.global.newest||e}function rt(...t){return t}function st(t){const e=ht.stateConfig;return e.states[e.statesIndex]=t,++e.statesIndex,t(rt)}function ct(t){const e=ht.stateConfig,n=e.statesIndex,o=ot(e.prevSupport).states[n];let r=[];return o((function(...t){return r=t,t})),e.states[e.statesIndex]=t,++e.statesIndex,t((function(...t){return r}))}function at(t){const e=ht.stateConfig;e.handlers.handler=pt,e.handlers.statesHandler=st,e.rearray=[],e.stateArray=[],e.states=[],e.statesIndex=0,nt(t)}function ut(t,e,n){const o=ht.stateConfig;o.rearray=n,o.stateArray=[],o.states=[],o.statesIndex=0,o.handlers.handler=lt,o.handlers.statesHandler=ct,o.prevSupport=e,nt(t)}class it{}function lt(){const t=ht.stateConfig,e=t.rearray[t.stateArray.length];return t.stateArray.push(e),e.defaultValue}function pt(t){const e=ht.stateConfig;let n=t;if(typeof t===k.function&&(n=t()),typeof n===k.function){const t=n;n=function(...e){return t(...e)},n.original=t}const o={get:function(){return function(t){const e=t.callback;if(!e)return t.defaultValue;const[n]=function(t){const[e]=t(it),[n]=t(e);return[e,n]}(e);return n}(o)},defaultValue:n};return e.stateArray.push(o),n}function ft(t,e,n){const o=[...e],r=o.shift(),s=t=>{if(o.length)return ft(t,o,n);n(t)};let c=s;const a=r(t,{setHandler:t=>c=t,next:s});c(a)}class gt{value;onSubscription;methods=[];isSubject=!0;subscribers=[];subscribeWith;constructor(t,e){this.value=t,this.onSubscription=e}subscribe(t){const e=function(t,e,n){const o=gt.globalSubCount$;gt.globalSubCount$.next(o.value+1);const r=function(){r.unsubscribe()};return r.callback=e,r.subscriptions=[],r.unsubscribe=function(){return function(t,e,n){!function(t,e){const n=t.findIndex((t=>t.callback===e));-1!==n&&t.splice(n,1)}(e,n);const o=gt.globalSubCount$;gt.globalSubCount$.next(o.value-1),t.unsubscribe=()=>t;const r=t.subscriptions;for(const t of r)t.unsubscribe();return t}(r,n,e)},r.add=t=>(r.subscriptions.push(t),r),r.next=t=>{e(t,r)},r}(0,t,this.subscribers),n=this.subscribeWith;if(n){if(this.methods.length){const n=t;t=t=>{ft(t,this.methods,(t=>n(t,e)))}}return n(t)}return this.subscribers.push(e),this.onSubscription&&this.onSubscription(e),e}next(t){this.value=t,this.emit()}set=this.next.bind(this);emit(){const t=this.value,e=this.subscribers;for(const n of e)n.callback(t,n)}toPromise(){return new Promise((t=>{this.subscribe(((e,n)=>{n.unsubscribe(),t(e)}))}))}toCallback(t){const e=this.subscribe(((n,o)=>{const r=o?.unsubscribe;r?r():setTimeout((()=>e.unsubscribe()),0),t(n)}));return this}pipe(...t){const e=new gt(this.value);return e.setMethods(t),e.subscribeWith=t=>this.subscribe(t),e.next=t=>this.next(t),e}setMethods(t){this.methods=t}static all(t){const e=t.map((t=>function(t){return F(t)&&typeof t.subscribe===k.function}(t)?t:new gt(t,(e=>(e.next(t),e)))));return function(t){const e=new gt;return e.subscribeWith=e=>{const n=[],o=[],r=(r,s)=>{if(n[s]=!0,o[s]=r,n.length===t.length){for(const t of n)if(!t)return;e(o,c)}},s=[...t],c=s.shift().subscribe((t=>r(t,0))),a=s.map(((t,e)=>t.subscribe((t=>r(t,e+1)))));return c.subscriptions=a,c},e}(e)}static globalSubCount$=new gt(0)}const dt=new gt(void 0,(function(t){et()||t.next()})),ht={stateConfig:{stateArray:[],version:Date.now(),handlers:{handler:pt,statesHandler:st}},tagClosed$:dt};function mt(t){return t.renderCount=t.renderCount||0,t.global={}}function bt(t,e,n,o,r){const s=n[e],c=t[s.valueIndex];c!==s.value&&(s.tagJsVar.processUpdate(c,o,s,r,t),s.value=c)}function yt(t,e){const n=t.context.global.contexts;!function(t,e){const n=e.templater,o=e.templater.tag,r=n.values||o.values;t.templater.tag.values=r}(t,e),++Rn.locks,function(t,e){const n=t.templater.tag.values;let o=0;const r=n.length,s={added:0,removed:0};for(;o<r;)bt(n,o,e,t,s),++o}(t,n),--Rn.locks,Dn()}function wt(t){return t.map(vt)}function vt(t,e){const n=t,o=t?.tagJsType;if(o)switch(o){case S.signal:case S.subscribe:case S.stateRender:return;case S.dom:case S.tag:case S.templater:return wt(n.values)}return G(t)?wt(n):q(t,e)}function xt(t){return vt(t,qe)}function Tt(t){return vt(t,Ye)}function Ct(t,e,n){const o={templater:t,context:e,castedProps:n,appSupport:void 0},r=e.global;return r.blocked=[],r.destroy$=new gt,o}function kt(t,e,n,o){e.appSupport=n;const r=t.props;return r&&(e.propsConfig=function(t,e,n){const o=t.templater;if(o.tagJsType!==S.stateRender){switch(o.propWatch){case Fe.IMMUTABLE:return t.propsConfig={latest:e,castProps:n};case Fe.SHALLOW:return t.propsConfig={latest:e.map(xt),castProps:n}}return t.propsConfig={latest:e.map(Tt),castProps:n}}}(e,r,o)),e}function Et(t,e,n,o,r){const s=Ct(t,o,r);return s.ownerSupport=e,kt(t,s,n,r)}function St(t,e,n,o){const r=_(e);if(t.tagJsVar=e,r)return void 0===t.global&&mt(t),function(t,e,n,o){if(!e.global.newest)return void t.processInit(t,e,n,o,void 0,e.placeholder);!function(t,e,n){const o=n.global,r=o.newest,s=r.templater.wrapper;let c=e.templater.wrapper,a=!1;const u=e.templater.tagJsType,i=S.stateRender===u||S.renderOnce===u;if(i)a=e.templater.tagJsType===S.renderOnce||ve(r,e);else if(s&&c){const t=r.templater.tag?._innerHTML;t&&(c=e.outerHTML),a=s.original===c.original}const l=e.templater;if(!a)return void function(t,e,n){const o=t.global;Rt(o.oldest,o),mt(t),e.processInit(e,t,n,{added:0,removed:0},void 0,t.placeholder)}(n,l,t);const p=i||function(t,e){const n=function(t,e,n){if(sn(t,e))return 11;switch(n){case Fe.NONE:return 1;case Fe.SHALLOW:return X(t,e);case Fe.IMMUTABLE:return Ze(t,e)}return function(t,e){let n=t,o=e;return n=[...t],o=[...e||[]],!n.every(((t,e)=>function(t,e,n,o){const r=o[e];if(typeof t===k.object){const e={...t},n={...r||{}},o=Object.entries(e).every((([t,o])=>ze(o,n[t],(()=>{delete e[t],delete n[t]}))));return o}return ze(t,r,(function(){n.splice(e,1),o.splice(e,1)}))}(t,e,n,o)))&&7}(t,e)}(e.props,t.propsConfig.latest,t.templater.propWatch);return n}(r,l);p?n.locked?o.blocked.push(e):(on(e),++n.renderCount):function(t,e,n,o,r){const s=Qe(e,n,o,t.props,r),c=e.propsConfig;c.castProps=s;n.propsConfig.latest=c.latest}(l,e,r,t,l.propWatch===Fe.DEEP?Ye:qe)}(n,Et(t,n,n.appSupport,e),e)}(e,t,n,o),!0;const s=t.global;if(s){const o=s.newest;if(o)return typeof e===k.function||function(t,e,n,o){let r=n.templater||n;const s=t.templater.tag;s&&s._innerHTML&&(r=n.outerHTML||n._innerHTML.outerHTML);const c=Et(r,o,o.appSupport,e);yt(t.context.global.oldest,c)}(o,t,e,n),!0}return e.processInit(e,t,n,o,void 0,t.placeholder),!0}function At(t,e,n,o){t!==n.value&&function(t,e,n,o){const r=t.tagJsVar.checkValueChange(e,t,o,n);-1!==r&&Qt(e,t,n,r,o)}(n,t,e,o)}function Jt(t,e){const n=e.providers;if(n)for(const t of n)for(let n=t.children.length-1;n>=0;--n)t.children[n].context.global===e&&t.children.splice(n,1);e.destroy$&&e.destroy$.next(),t.context.renderCount=0}function Ot(t,e){for(const n of t){const t=n.lastArray;if(t){Ot(t,e);continue}const o=n.value;if(o?.tagJsType===S.subscribe){o.delete(n,e);continue}const r=n.global;if(!r)continue;const s=r.newest,c=r.subscriptions;c&&c.forEach(Pt),_(s.templater)&&Jt(s,r),Ot(r.contexts,s)}}function It(t,e=[],n=[]){for(const o of t){const t=o.global;if(!t)continue;const r=t.newest;if(r){e.push(r);const o=t.subscriptions;o&&n.push(...o)}const s=t.contexts;s&&It(s,e,n)}return{tags:e,subs:n}}function Pt(t){t.unsubscribe()}function Vt(t,e){return!G(t)&&(jt(e),9)}function jt(t){Mt(t,t.lastArray)}function Mt(t,e){for(let t=0;t<e.length;++t)Dt(e[t]);delete t.lastArray}function Lt(t,e){!function(t,e){for(const n of t){if(n.locked)continue;if(n.withinOwnerElement){const t=n.tagJsVar;if(t&&"host"===t.tagJsType){const e=n.supportOwner;t.delete(n,e)}continue}const t=n.lastArray;if(t){Mt(n,t);continue}const o=n.simpleValueElm;if(o){delete n.simpleValueElm,$n(o);continue}const r=n.global;void 0!==r&&(!0!==r.deleted&&(r.deleted=!0,r.oldest&&Lt(r,e)))}}(t.contexts,e),function(t){const e=t.htmlDomMeta;for(let t=e.length-1;t>=0;--t)Nt(e[t]),e.splice(t,1)}(t)}function Nt(t){const e=t.marker;e&&$n(e);const n=t.domElement;n&&$n(n)}function Rt(t,e){const n=t.context;e.deleted=!0,n.renderCount=0;const o=[];return Ot(e.contexts,t),e.destroy$&&Jt(t,e),Lt(e,o),o}function Wt(t,e,n,o){const r=t.length-1,s=e-o,c=s<0||r<s,a=n[e];if(c)return Dt(a),1;const u=function(t,e,n,o,r){return e&&t!==e.arrayValue?(Dt(n),o.splice(r,1),2):0}(a.value.arrayValue,t[e],a,n,e);return u}function Dt(t){!function(t,e){if(t)return void Rt(t.oldest,t);const n=e.simpleValueElm;delete e.simpleValueElm,$n(n)}(t.global,t)}function $t(t,e,n,o,r,s){const c=e.context;c.locked=!0,function(t,e,n,o,r,s){e.tagJsVar.processInit(t,e,n,o,r,s)}(t,n,e,o,r,s),delete c.locked,n.value=t}function Ht(t){switch(t){case void 0:case!1:case null:return T}return t}function Ut(t){return{tagJsType:"simple",value:t,processInit:_t,delete:Bt,checkValueChange:Ft,processUpdate:At}}function _t(t,e,n,o,r,s){const c=Ht(t);s=e.placeholder;const a=e.paint=[Fn,[s,c,function(t){e.simpleValueElm=t,delete e.paint}]];Vn.push(a)}function Bt(t){const e=t.simpleValueElm;delete t.simpleValueElm,$n(e)}function Ft(t,e){return null!=t&&typeof t===k.object?(Bt(e),6):(function(t,e){const n=Ht(t);if(e.paint)return void(e.paint[1][1]=n);const o=e.simpleValueElm;Mn.push([Wn,[n,o]])}(t,e),-1)}function Gt(t){return{tagJsType:"array",value:t,processInit:zt,processUpdate:At,checkValueChange:Vt,delete:jt}}function zt(t,e,n,o,r){Yt(e,t,n,o,r)}function Zt(t){const e=t?.tagJsType;return e?t:function(t){return G(t)?Gt(t):Ut(t)}(t)}function qt(t,e,n,o,r,s){const c=document.createTextNode(T),a={value:t,tagJsVar:Zt(t),withinOwnerElement:!1,placeholder:c,valueIndex:o.length,valueIndexSetBy:"createAndProcessContextItem"};return s||Vn.push([Un,[r,c]]),$t(t,e,a,n,s,r),s&&Ln.push([_n,[s,c]]),a}function Yt(t,e,n,o,r){const s=void 0===t.lastArray;s&&(t.lastArray=[]);const c=t.lastArray;let a=t.placeholder,u=0;const i=[];if(!s){for(let t=0;t<c.length;++t){const n=c[t],o=Wt(e,t,c,u);0!==o?2!==o?u+=o:t-=1:i.push(n)}t.lastArray=i}const l=e.length;for(let s=0;s<l;++s)a=Kt(e,s,t.lastArray,n,a,o,r).placeholder}function Kt(t,e,n,o,r,s,c){const a=t[e],u=n[e];if(u)return function(t,e,n,o,r,s,c,a){if(n.length>r)return At(t,o,e,c),e;const u=qt(t,o,c,n,s,a);return n.push(u),u}(a,u,n,o,e,r,s,c);const i=qt(a,o,s,n,r,c);return n.push(i),i}function Qt(t,e,n,o,r){const s=t&&t.tagJsType;if(e.tagJsVar=Zt(t),s){if(s===S.renderOnce)return;St(e,t,n,r)}else{if(G(t))return Yt(e,t,n,r),void(e.tagJsVar=Gt(t));typeof t!==k.function?o&&function(t,e){e.value=t,e.tagJsVar=Ut(t);const n=e.placeholder,o=Ht(t),r=e.paint=[Fn,[n,o,function(t){e.simpleValueElm=t,delete e.paint}]];Vn.push(r)}(t,e):e.value=t}}class Xt extends gt{value;constructor(t){super(t),this.value=t}subscribe(t){const e=super.subscribe(t);return t(this.value,e),e}}function te(t){return ht.stateConfig.handlers.handler(t)}function ee(t,e){for(let n=0;n<t.length;++n)se(t[n],e[n])}let ne;function oe(...t){return ne=t,t}function re(){return ne}function se(t,e){t(oe,1),e(re,2)}function ce(t,e,n,o){for(let n=t.length-1;n>=0;--n){const o=t[n].get(),r=e[n].callback;r&&r(o)}for(let t=o.length-1;t>=0;--t)ue.length=0,ae=0,(0,o[t])(ie),n[t](le)}let ae=0;const ue=[];function ie(...t){return ue.push(t),t}function le(...t){return ue[ae++]}const pe=t=>t,fe=(t,e,{init:n,before:o,final:r=pe}={})=>{const s=te({pastResult:void 0,values:void 0}),c=s.values;if(void 0===c){if(o&&!o(t))return s.values=t,s.pastResult;const a=(n||e)(t,c);return s.pastResult=r(a),s.values=t,s.pastResult}if(t.every(((t,e)=>t===c[e])))return s.pastResult;if(o&&!o(t))return s.values=t,s.pastResult;const a=e(t,c);return s.pastResult=r(a),c.length=0,c.push(...t),s.pastResult};function ge(t,e){return Object.defineProperty(e,"noInit",{get(){const e=t();return e.setup.init=()=>{},e}}),Object.defineProperty(e,"asSubject",{get(){const e=t(),n=te((()=>et())),o=te((()=>new Xt(void 0))),r=te((()=>({stateArray:ht.stateConfig.stateArray,states:ht.stateConfig.states}))),s=(t,s)=>(fe(t,((t,e)=>{const c=et(),a=s(t,e);if(c!==n){const t=r.stateArray,e=n.context.global.oldest;ce(t,e.state,r.states,e.states)}o.next(a)}),e.setup),o);return s.setup=e.setup,ge((()=>s),s),s}}),Object.defineProperty(e,"truthy",{get(){const e=t();return e.setup.before=t=>t.every((t=>t)),e}}),e}function de(t){return et()?te((()=>new gt(t))):new gt(t)}ge((()=>function(t){const e=(e,n)=>fe(e,n,t);return e.setup=t,ge((()=>e),e),e}({})),((t,e)=>fe(t,e))),de._value=t=>{const e=te((function(){return{stateArray:ht.stateConfig.stateArray,states:ht.stateConfig.states}})),n=et();return te((function(){return new Xt(t).pipe((t=>(ce(n.state,e.stateArray,n.states,e.states),t)))}))},de.all=function(t){const e=te((()=>({stateArray:ht.stateConfig.stateArray,states:ht.stateConfig.states}))),n=et();return gt.all(t).pipe((t=>(ce(n.state,e.stateArray,n.states,e.states),t)))};class he extends Error{details;constructor(t,e,n={}){super(t),this.name=he.name,this.details={...n,errorCode:e}}}class me extends he{constructor(t,e){super(t,"state-mismatch-error",e),this.name=me.name}}class be extends he{constructor(t,e){super(t,"sync-callback-error",e),this.name=be.name}}function ye(t){++Rn.locks,t.forEach(we),--Rn.locks,Dn()}function we(t){const e=t.context.global;e&&on(e.newest)}function ve(t,e){const n=xe(t,e);return!(n||!e.templater.tag?._innerHTML||!xe(t.outerHTML,e))||n}function xe(t,e){const n=t.templater,o=e.templater,r=n?.tag||t,s=o.tag;if(n?.tagJsType===S.stateRender)return n.dom===o.dom;switch(r.tagJsType){case S.dom:return s?.tagJsType===S.dom&&function(t,e){return t.dom===e.dom}(r,s);case S.tag:{const n=function(t,e,n,o){const r=t.strings,s=e.strings;if(r.length!==s.length)return!1;if(!r.every(((t,e)=>s[e].length===t.length)))return!1;return function(t,e){if(!(t.length===e.length))return!1;return!!e.every((function(e,n){const o=t[n];return typeof e!==k.function||typeof o!==k.function||!(e.toString()!==o.toString())}))}(n.templater.values||t.values,o.templater.values||e.values)}(r,s,t,e);return n}}throw new Error(`unknown tagJsType of ${r.tagJsType}`)}function Te(t,e,n){const o=e.global,r=o?.newest;if(U(t))return ve(t,r)?(St(e,t,r,n),-1):(Rt(r,o),mt(e),7);const s=t?.tagJsType;return s?!0===St(e,t,o.newest.ownerSupport,n)?-1:88:(Ce(e),8)}function Ce(t){const e=t.global,n=e?.newest;Rt(n,e),delete t.global,t.renderCount=0}function ke(t,e,n,o){const r=t.context.global;r.oldest=t,r.newest=t,++Rn.locks;const s=function(t,e,n,o){const r=function(t){const e=t.templater.tag;if(e.tagJsType===S.dom)return e.dom;return j(e.strings,e.values)}(t),s=t.templater.tag.values,c=[];t.context.global.contexts=c;return Jn(r,s,t,e,c,0,n,o)}(t,e,n,o);return r.htmlDomMeta=s.dom,--Rn.locks,s}function Ee(t,e,n){const o={value:t,valueIndex:e.length,valueIndexSetBy:"addOneContext",tagJsVar:Zt(t),withinOwnerElement:n};return e.push(o),o}function Se(t,e,n){const o=e.global.newest,r=e.placeholder;return o.ownerSupport=t,ke(o,n,void 0,r),o}function Ae(t,e,n){const o=function(t,e,n,o,r){const s={templater:t,context:o,castedProps:void 0,appSupport:void 0};return s.ownerSupport=e,s.appSupport=n,s}(t,e,e.appSupport,n);return n.global.contexts=[],o}function Je(t,e,n,o,r,s){const c=Ae(t,n,e);c.ownerSupport=n;const a=ke(c,o,r,r?void 0:s);for(const t of a.dom)t.marker&&(r?Ln.push([_n,[r,t.marker]]):Vn.push([Un,[s,t.marker]])),t.domElement&&(r?Ln.push([_n,[r,t.domElement]]):Vn.push([Un,[s,t.domElement]]));return c}function Oe(t,e,n,o,r,s){return r?Je(t,e,n,o,r,s):Se(n,e,o)}function Ie(t,e){const n={tagJsType:S.templater,processInit:Oe,processUpdate:At,checkValueChange:Te,delete:Ce,propWatch:t,props:e,key:function(t){return n.arrayValue=t,n}};return n}new be("callback() was called outside of synchronous rendering. Use `callback = callbackMaker()` to create a callback that could be called out of sync with rendering");const Pe=[];function Ve(t){const e=t.context;return nn(t.templater)?rn(t):en(t,t,e)}function je(t,e,n){return t.map((function(t){return function(t,e,n,o){return U(t)||!t?t:e?Me(t,e,n,o):t}(t,e.ownerSupport,e,n)}))}function Me(t,e,n,o,r){return t?t.tagJsType?t:typeof t===k.function?o<=1?function(t,e,n){if(t.mem)return t;const o=function(...t){return function(t,e,n,o){const r=o.context.global,s=r?.newest||o,c=void 0===et(),a=t.apply(e,n),u=function(){const t=s.context;return t.global&&!0!==t.locked?(Ve(s),a):a};return c?u():(ht.tagClosed$.toCallback(u),a)}(o.mem,e,t,n)};return o.original=t,o.mem=t,Object.assign(o,t),o}(t,r,e):t:o===Ye||Ne(t)?t:G(t)?function(t,e,n,o){for(let r=t.length-1;r>=0;--r){const s=t[r];if(t[r]=Me(s,n,e,o+1,t),typeof s===k.function){if(s.mem)continue;Le(o+1,r,s,t,e)}}return t}(t,n,e,o):function(t,e,n,o){const r=Object.keys(t);for(const s of r){const r=t[s],c=Me(r,n,e,o+1,t);if(t[s]===c)continue;const a=Object.getOwnPropertyDescriptor(t,s);if(!a?.get&&!a?.set&&(t[s]=c,typeof c===k.function)){if(r.mem)continue;Le(o+1,s,r,t,e)}}return t}(t,n,e,o):t}function Le(t,e,n,o,r){if(t>0){const t=r.context.global;o[e].subscription=t.destroy$.toCallback((function(){o[e]=n}))}}function Ne(t){return typeof t!==k.object||!t||t.tagJsType}function Re(t,e,n,o){const r=e.original,s=t.tagJsType===S.stateRender,c=ht.stateConfig;let a;return nt(n),s?a=t():(a=r(...o),typeof a===k.function&&(a=a())),a.templater=t,t.tag=a,n.state=c.stateArray,n.states=c.states,n}function We(t,e,n){const o=t.propWatch===Fe.DEEP?Ye:qe,r=t.props,s=e.propsConfig;let c=s.castProps;const a=n?.propsConfig,u=a?.castProps;return u&&(s.castProps=u,c=Qe(e,n,n.ownerSupport,r,o)),c||je(r,e,0)}const De="State tracking requires same number of state calls on every render. This error typically occurs when a state call is only reachable behind a condition. Also, wrapping tags that have state, with tag(), often helps when tag is only reachable by a condition.";function $e(t,e){const n=t.context;++n.renderCount;const o=ht.stateConfig;t.state=o.stateArray,t.states=o.states,n.global.newest=t,function(t,e){const n=t.rearray;n.length&&n.length!==t.stateArray.length&&function(t,e,n){const o=`Saved states between renders are inconsistent. Expected ${t.length} states got ${n.stateArray.length}.`,r=e.templater?.wrapper;let s=r;(r?.original||r?.original)&&(s=r.original);const c={oldStates:n.stateArray,newStates:n.rearray,tagFunction:s,templater:e.templater},a=new me(o,c);throw console.error(De,c),a}(n,e,t)}(o,t),delete o.prevSupport,delete o.support,delete o.stateArray,delete o.states,ht.tagClosed$.next(e)}function He(t,e,n,o){!function(t,e){const n=e?.state;n?ut(t,e,n):at(t)}(t,e);const r=t.templater;let s;if(r.tagJsType===S.stateRender){const e=r;s=Et(r,o,t.appSupport,n),Re(r,e,s)}else s=(0,r.wrapper)(t,n,e);return $e(s,o),s.ownerSupport=t.ownerSupport,s}function Ue(t,e,n,o,r,s){mt(e);const c=function(t,e,n){const o=Ie(Fe.DEEP);o.tagJsType=t.tagJsType;const r=Ae(o,n,e);function s(){return o.tag=t(),r}return o.wrapper=s,s.tagJsType=t.tagJsType,s.original=t.original||t,r}(t,e,n);return He(c,void 0,e),Je(c.templater,e,n,o,r,s)}function _e(t,e,n,o,r){if(mt(e),r)return function(t,e,n,o,r){const s=Et(t,n,n.appSupport,e),c=s.propsConfig;if(c){const e=t.tagJsType!==S.tagComponent?[]:We(t,s);c.castProps=e}return function(t,e,n){const o=ke(t,e,n,void 0);for(const t of o.dom)t.domElement&&Ln.push([_n,[n,t.domElement]]),t.marker&&Ln.push([_n,[n,t.marker]]);return t}(He(s,e.global.newest,e),o,r)}(t,e,n,o,r);const s=function(t,e,n,o){const r=Et(t,n,n.appSupport,e),s=r.propsConfig;if(s){const e=t.tagJsType!==S.tagComponent?[]:We(t,r);s.castProps=e}const c=He(r,e.global.newest,e);return ke(c,o,void 0,e.placeholder),c}(t,e,n,o);return s}let Be=0;var Fe;function Ge(t,e=Fe.SHALLOW){const n=function(...o){const r=Ie(e,o);r.tagJsType=S.tagComponent,r.processInit=_e;const s=function(t,e){return function(n,o,r){const s=We(t,n,r),c=n.ownerSupport,a=Et(t,c,n.appSupport,o,s);return Re(t,e,a,s)}}(r,n);return s.original=t,r.wrapper=s,r},o=t;return n.original=t,o.tags=Pe,o.setUse=ht,o.ValueTypes=S,o.tagIndex=Be++,Pe.push(n),n}function ze(t,e,n){if(typeof t!==k.function)return!!K(t,e,Ye)&&4;if(typeof e!==k.function)return!1;const o=e?.original;return o&&(e=o),t.original&&(t=t.original),t.toString()===e.toString()?(n(),5):(n(),6)}function Ze(t,e){const n=t.length;for(let o=0;o<n;++o)if(t[o]!==e[o])return 2;return!1}!function(t){t.DEEP="deep",t.SHALLOW="shallow",t.NONE="none",t.IMMUTABLE="immutable"}(Fe||(Fe={})),Ge.renderOnce=function(){throw new Error("Do not call tag.renderOnce as a function but instead set it as: `(props) => tag.renderOnce = () => html`` `")},Ge.use=function(){throw new Error("Do not call tag.use as a function but instead set it as: `(props) => tag.use = (use) => html`` `")},Ge.deepPropWatch=Ge,Ge.route=function(t){throw new Error("Do not call tag.route as a function but instead set it as: `tag.route = (routeProps: RouteProps) => (state) => html`` `")},Ge.app=function(t){throw new Error("Do not call tag.route as a function but instead set it as: `tag.route = (routeProps: RouteProps) => (state) => html`` `")},Ge.immutableProps=function(t){return Ge(t,Fe.IMMUTABLE)},Ge.watchProps=function(t){return Ge(t,Fe.SHALLOW)},Object.defineProperty(Ge,"renderOnce",{set(t){t.tagJsType=S.renderOnce,t.processInit=Ue,t.processUpdate=At,t.delete=Ce,t.checkValueChange=function(){return-1}}}),Object.defineProperty(Ge,"use",{set(t){t.original={setUse:ht,tags:Pe},t.tagJsType=S.stateRender,t.processInit=_e,t.processUpdate=At,t.checkValueChange=Te,t.delete=Ce}});const qe=3,Ye=10;function Ke(t,e,n,o,r,s){return null==t||s>r?e:typeof t===k.function?e.mem?(t.mem=e.mem,e):(t.mem=e,t):Ne(e)?e:G(e)?function(t,e,n,o,r,s){for(let c=t.length-1;c>=0;--c){const a=t[c],u=e[c];t[c]=Ke(u,a,n,o,s,r+1)}return t}(e,t,n,o,s,r):function(t,e,n,o,r,s){const c=Object.keys(t);for(const a of c){const c=t[a],u=Ke(e[a],c,n,o,s,r+1);if(c===u)continue;const i=Object.getOwnPropertyDescriptor(t,a)?.set;i||(t[a]=u)}return t}(e,t,n,o,s,r)}function Qe(t,e,n,o,r,s=-1){const c=e.context.global;if(!c||!c.newest){const e=je(o,t,s);return o.push(...e),t.propsConfig.castProps=e,o}const a=(e=c.newest||e).propsConfig.castProps,u=[];for(let e=0;e<o.length;++e){const c=o[e],i=Ke(a[e],c,t,n,r,s+1);u.push(i)}return t.propsConfig.castProps=u,u}function Xe(t){const e=t.context,n=e.global,{subs:o,tags:r}=It(n.contexts);tn(n);for(const t of r){const e=t.context.global;if(!0===e.deleted)return;tn(e)}n.subscriptions&&o.forEach(Pt),mt(e)}function tn(t){t.deleted=!0,Lt(t,[])}function en(t,e,n){const o=function(t,e,n){const o=He(t,e,n),r=!e||ve(e,o);if(r){if(e){const t=e.templater.tag;if(t&&n.renderCount>0){const n=e?.templater,o=n?.tag;!function(t,e,n){if(t.tagJsType!==S.dom){if(n){const o=n.strings;if(o){const n=o?.length;n!==t.strings.length&&Xe(e)}}}else{const o=n?.dom;o!==t.dom&&Xe(e)}}(t,e,o)}}}else{!function(t,e){const n=t.context.global;let o=-1;const r=n.providers=n.providers||[],s=r.length-1;for(;o++<s;){const t=r[o];let s=-1;const c=t.children.length-1;for(;s++<c;)if(n===t.children[s].context.global)return t.children.splice(s,1),void t.children.push(e)}}(e,o),Xe(e);const t=o.context.global;t.oldest=o,t.newest=o}return o.ownerSupport=t.ownerSupport,{support:o,wasLikeTags:r}}(e,t,n),r=n.global;return o.wasLikeTags?(yt(r.oldest,o.support),o.support):Se(e,n,{added:0,removed:0})}function nn(t){return S.templater===t.tagJsType}function on(t){const e=t.context,n=e.global,o=nn(t.templater);if(e.locked)return n.blocked.push(t),t;if(o)return rn(t);e.locked=!0,n.blocked.length&&(t=n.blocked.pop(),n.blocked=[]);const r=en(n.newest,t,e);return delete e.locked,r}function rn(t){return on(ot(t).context.global.newest)}function sn(t,e){return t.length!==e.length}function cn(t,e=[]){const n=t.context,o=nn(t.templater),r=t.ownerSupport;if(n.locked)return e.push(t),e;if(o)return cn(r,e);const s=t,c=_(s.templater),a=t.templater.tagJsType,u=r&&a!==S.stateRender&&(!c||function(t,e){const n=function(t,e){const n=t.props,o=e.propsConfig.latest;if(sn(n,o))return!0;switch(t.propWatch){case Fe.IMMUTABLE:return Ze(n,o);case Fe.SHALLOW:return X(n,o)}return!K(n,o,Ye)}(t,e);return!!n}(s.templater,s)),i=function(t){const e=t.context.global.providers;if(!e)return[];const n=[];for(const t of e){const e=z(t.owner,t);n.push(...e.map(Z))}return n}(s);return e.push(...i),u?(cn(r,e),c&&e.push(s),e):(e.push(s),e)}function an(t,e){const n=e.context.global,o=function(t,e){if(!0!==n.deleted)return function(t,e,n,o){const r=ot(e),s=r.context;s.locked=!0;const c=t.apply(n,o);return delete s.locked,function(t,e){return e.context.global,function(t,e,n){return ye(cn(t)),function(t,e,n,o,{resolvePromise:r,resolveValue:s}){var c;return(c=t)&&B(c.then)?(e.context.locked=!0,t.then(function(t,e){return n=>{if(!0===t.context.global.deleted)return e(n);const o=t.context,r=t.context.global;var s,c;return delete o.locked,s=t,c=r.newest,ee(s.states,c.states),ye(cn(t)),e(n)}}(e,r))):s(t)}(e,t,0,0,{resolvePromise:pn,resolveValue:fn})}(e,t)}(c,r)}(o.tagFunction,o.support,t,e)};return o.tagFunction=t,o.support=e,o}const un="no-data-ever",ln="promise-no-data-ever";function pn(){return ln}function fn(){return un}function gn(t,e,n,o,r,s,c){if(c)return N(t,e,n,c);o(n,t,e)}function dn(t,e,n,o){const r=t.appElement;"blur"===e&&(e="focusout");const s="_"+e,c=t.context.global.events;if(!c[e]){const t=function(t){t.originalStopPropagation=t.stopPropagation,hn(t,s,t.target)};c[e]=t,r.addEventListener(e,t)}n[s]=o,n[e]=o}function hn(t,e,n){const o=n[e];if(o){let e=!1;if(t.stopPropagation=function(){e=!0,t.originalStopPropagation.call(t)},o(t),t.defaultPrevented||e)return}const r=n.parentNode;r&&hn(t,e,r)}function mn(t,e,n,o){const r=function(...e){return r.tagFunction(t,e)};r.tagFunction=e,r.support=n,dn(n.appSupport,o,t,r)}function bn(t){return null==t||!1===t}function yn(t,e){t.removeAttribute(e)}function wn(t,e,n,o,r){if(n.isNameOnly)return function(t,e,n,o,r,s,c,a){if(n){if(bn(e))return void o.removeAttribute(n);if(typeof n===k.object)if(typeof e===k.object)for(const t in n)t in e||Mn.push([yn,[o,t]]);else for(const t in n)Mn.push([yn,[o,t]])}Tn(t,e,o,r,s,[],{added:0,removed:0})}(r,t,n.value,n.element,e,n.howToSet),void(n.value=t);const s=n.element;!function(t,e,n,o,r,s,c,a){if(B(t))return function(t,e,n,o,r,s,c,a){const u=t.templater.wrapper;return(u?.tagJsType||u?.original?.tagJsType)!==S.renderOnce?kn(c,e,t,o,n):Cn(e,n,o,r,s,t)}(r,t,o,e,c,s,n);Cn(t,o,e,c,s,r)}(t,n.attrName,n,s,e,n.howToSet,n.isSpecial),n.value=t}function vn(t){return F(t)&&"tagJsVar"in t?t.tagJsVar:-1}function xn(t,e,n,o,r,s,a,u,i){const l=vn(e);if(l>=0){const e=t[l],c=Ee(e,s,!0);return c.valueIndex=l,c.valueIndexSetBy="processAttribute",c.isAttr=!0,c.element=n,c.isNameOnly=!0,e.tagJsType?(c.tagJsVar=e,c.stateOwner=ot(o),c.supportOwner=o,function(t,e,n){e.processInit(t,e,n)}(n,e,c)):(c.howToSet=r,c.tagJsVar.processUpdate=wn,void Tn(t,e,n,o,r,s,u))}if(Array.isArray(i))return function(t,e,n,o,r,s,a,u,i){const l=o.length;function p(o){const s=function(t,e,n){return t.reduce(((t,o)=>{if(c(o)>=0){const o=n++,r=e[o];return t.push(r),t}return t.push(o),t}),[])}(e,o,l).join("");r(n,t,s)}e.forEach((e=>{if(c(e)>=0){const r=o.length,s=Zt(e),c={isAttr:!0,element:n,attrName:t,withinOwnerElement:!0,tagJsVar:s,valueIndex:o.length,valueIndexSetBy:"createDynamicArrayAttribute"};s.processUpdate=function(t,e,n,o,r){p(r)};const a=u[r];c.value=a,o.push(c)}})),p(u)}(e,i,n,s,r,0,0,t);const p=vn(i);return p>=0?function(t,e,n,o,r,s,c,a,u){const i=Zt(e),l={isAttr:!0,element:n,attrName:t,withinOwnerElement:!0,tagJsVar:i,valueIndex:u,valueIndexSetBy:"createDynamicAttribute"};o.push(l),i.processUpdate=wn,function(t,e,n,o,r,s,c,a){n.element=o,n.howToSet=r,typeof e===k.function?kn(n,e,s,t,o):(n.attrName=t,n.isSpecial=a,gn(t,e,o,r,0,0,a))}(t,e,l,n,r,s,0,a),l.value=e}(e,t[p],n,s,r,o,0,a,p):gn(e,i,n,r,0,0,a)}function Tn(t,e,n,o,s,c,a){if(!bn(e))if(typeof e!==k.object)0!==e.length&&s(n,e,T);else for(const u in e){const i=e[u];xn(t,u,n,o,s,c,r(u),a,i)}}function Cn(t,e,n,o,r,s,c){if(!1===o){switch(t){case void 0:case!1:case null:return void Mn.push([En,[e,n]])}if(B(t))return mn(e,t,s,n);r(e,n,t)}else N(n,t,e,o)}function kn(t,e,n,o,r){return e=an(e,n),t.tagJsVar.processUpdate=wn,mn(r,e,n,o)}function En(t,e){t.removeAttribute(e)}function Sn(t,e,n,o,r,s,c){const a=document.createTextNode(T),u=Ee(t,e,r>0);u.placeholder=a,s?Ln.push([_n,[s,a]]):Vn.push([Un,[c,a]]),$t(t,n,u,o,s,c)}const An=function(){};function Jn(t,e,n,o,r,s,c,a){const u=[];c&&void 0===a&&(a=document.createTextNode(T),Ln.push([_n,[c,a]]),c=void 0);for(let i=0;i<t.length;++i){const l=t[i],p=l.v;if(!isNaN(p)){Sn(e[r.length],r,n,o,s,c,a);continue}const f={};if(u.push(f),"text"===l.nn){In(f,l,c,a);continue}const g=On(f,l,e,n,r,o,c,a);l.ch&&(f.ch=Jn(l.ch,e,n,o,r,s+1,g,a).dom)}return{dom:u,contexts:r}}function On(t,e,n,o,r,s,c,a){const u=t.domElement=document.createElement(e.nn);if(e.at)for(const t of e.at){const e=t[0],c=t[1],a=t[2]||!1;xn(n,e,u,o,t.length>1?L:M,r,a,s,c)}return c?Ln.push([_n,[c,u]]):Vn.push([Un,[a,u]]),u}function In(t,e,n,o){const r=t,s=r.tc=e.tc;n?Ln.push([zn,[n,s,function(t){r.domElement=t}]]):Vn.push([Gn,[o,s,function(t){r.domElement=t}]])}let Pn=[],Vn=[],jn=[],Mn=[],Ln=[],Nn=[];const Rn={locks:0,removeLocks:0};function Wn(t,e){e.textContent=t}function Dn(){if(!(Rn.locks>0))return function(){(function(){if(Pn.length){const t=Pn.map((t=>t.promise.then((()=>{const e=t.paintRemoves;for(const t of e)t[0](...t[1])}))));Pn=[];const e=jn;return Promise.all(t).then((()=>{for(const t of e)t[0](...t[1])}))}for(const t of jn)t[0](...t[1])})(),jn=[];for(const t of Mn)t[0](...t[1]);for(const t of Ln)t[0](...t[1]);for(const t of Vn)t[0](...t[1])}(),void function(){Vn=[],Mn=[],Ln=[];const t=Nn;Nn=[];for(const e of t)e[0](...e[1])}()}function $n(t){jn.push([Hn,[t]])}function Hn(t,e){t.parentNode.removeChild(t)}function Un(t,e){t.parentNode.insertBefore(e,t)}function _n(t,e){t.appendChild(e)}const Bn="object"==typeof document&&document.createElement("div");function Fn(t,e,n=An){const o=function(t){return Bn.innerHTML=t,document.createTextNode(Bn.innerHTML)}(e);Un(t,o),n(o)}function Gn(t,e,n=An){Bn.innerHTML=e;const o=document.createTextNode(Bn.textContent);Un(t,o),n(o)}function zn(t,e,n){Bn.innerHTML=e;const o=document.createTextNode(Bn.textContent);_n(t,o),n(o)}function Zn(t,e){t.domElement&&e.appendChild(t.domElement),t.marker&&e.appendChild(t.marker)}function qn(t,e,n){const o=e.global,r=Ct(t,e);return kt(t,r,r),r.appElement=n,o.oldest=o.oldest||r,o.newest=r,r}"object"==typeof document&&(document.taggedJs&&console.warn("ðŸ·ï¸ðŸ·ï¸ Multiple versions of taggedjs are loaded. May cause issues."),document.taggedJs=!0);const Yn=[];function Kn(t,e,n){const o=Yn.findIndex((t=>t.element===e));if(o>=0){const t=Yn[o].support;Rt(t,t.context.global),Yn.splice(o,1),console.warn("Found and destroyed app element already rendered to element",{element:e})}let r=()=>a(n);r.propWatch=Fe.NONE,r.tagJsType=S.stateRender,r.processUpdate=At,r.props=[n],r.isApp=!0;const s=function(t,e){const n={value:t,valueIndex:0,valueIndexSetBy:"getNewSubject",withinOwnerElement:!1,renderCount:0,global:void 0,tagJsVar:{tagJsType:"templater",checkValueChange:Te,delete:Ce,processInit:function(){console.debug("do nothing app function")},processUpdate:At}};return mt(n).events={},qn(t,n,e),n}(r,e),c=s.global;at(c.newest);let a=t(n);const u=typeof a==k.function;return u||(_(a)?(c.newest.propsConfig={latest:[n],castProps:[n]},r.propWatch=a.propWatch,r.tagJsType=a.tagJsType,r.wrapper=a.wrapper,r=a):(r.tag=a,a=t)),function(t,e,n,o,r,s,c){const a=document.createTextNode(T);Pe.push(n.wrapper||{original:n});const u=function(t,e,n,o,r){o.placeholder=e;const s=o.global,c=s.oldest,a=s.newest===c,u=Et(t,s.newest,s.newest.appSupport,o);if(a||ut(u,s.newest,c.state),t.tagJsType===S.stateRender)return function(t,e,n,o,r){const s=t.wrapper||{original:t};if(!e){const e=qn(t,o,r);return $e(e),e}return Re(t,s,n),$e(n),n}(t,r,u,o,n);const i=(0,t.wrapper)(u,o);return $e(u),i}(n,a,r,s,c);if(e.isApp=!0,c&&(o.tag=u.templater.tag),!r)throw new Error(`Cannot tagElement, element received is type ${typeof r} and not type Element`);r.destroy=function(){const t=e.events;for(const e in t){const n=t[e];r.removeEventListener(e,n)}e.events={},++Rn.locks;const n=Rt(u,e);return--Rn.locks,Dn(),n},++Rn.locks;const i=function(t,e,n,o,r,s){console.debug("ðŸ·ï¸ Building element into tag...",{element:e,app:r,support:t});const c=ke(t,{added:0,removed:0},e,void 0);n.oldest=t,n.newest=t;let a=o.setUse;if(o.tagJsType!==S.stateRender){const t=r.original;a=t.setUse,t.isApp=!0}e.setUse=a,e.ValueTypes=S,Yn.push({element:e,support:t});const u=document.createDocumentFragment();u.appendChild(s);for(const t of c.dom)Zn(t,u);return console.debug("ðŸ·ï¸ Element Tag DOM built âœ…"),u}(u,r,e,n,t,a);return--Rn.locks,Dn(),r.appendChild(i),{support:u,tags:Pe,ValueTypes:S}}(t,c,r,a,e,s,u)}function Qn(t,e={}){return{tagJsType:S.host,processInit:to,processUpdate:Xn,delete:eo,options:{callback:t,...e}}}function Xn(t,e,n,o){const r=function(t,e,n,o,r){if(!e||!e.tagJsType||e.tagJsType!==t)return o.tagJsVar.delete(o,n),Qt(e,o,n,99,r),99}(S.host,t,e,n,o);if(r)return r;const s=n.tagJsVar.options,c=n.element;s.callback(c,t,n)}function to(t,e,n){e.options.callback(t,e,n);const o=e.options;if(o.onInit){const t=n.element;o.onInit(t,e,n)}}function eo(t){const e=t.tagJsVar,n=e.options;if(n.onDestroy){const o=t.element;!function(t,e,n){const o=n.context.global.newest;ee(o.states,n.states);const r=e(...t);ee(n.states,o.states),Nn.push([()=>{o.context.global&&(++Rn.locks,Ve(o),--Rn.locks,Dn())},[]])}([],(function(){return n.onDestroy(o,e,t)}),t.stateOwner)}}Qn.onInit=t=>Qn((()=>{}),{onInit:t}),Qn.onDestroy=t=>Qn((()=>{}),{onDestroy:t});const no={},oo={tagGateways:no,_stamp:Date.now()},ro={};function so(t,e){const n=e.getAttribute("props");if(n){const o=no[t];if(!o){const e=`Cannot find tag gateway by id ${n}`;throw console.warn(e,{fullId:t,propsId:n,gatewayIds:Object.keys(no),tagGatewayMemory:oo}),new Error(e)}const r=o.propMemory[n];return co(e,r.props),r}const o=e.getAttribute("propsJson");if(o){const t=JSON.parse(o);return co(e,t),{props:t,callCount:0}}const r=e.getAttributeNames().reduce(((t,n)=>{const o=n.split(":");let r=e.getAttribute(n);return o.length>1&&("number"===o[1]&&(r=Number(r)),n=o[0]),t[n]=r,t}),{});return delete r.tag,co(e,[r]),{props:[r],callCount:0}}function co(t,e){const n=t.getAttribute("events");n&&n.split(",").map((t=>t.trim())).map((t=>{e[0][t]=e=>o(t,{detail:{[t]:e}})}));const o=function(e,n){const o=new CustomEvent(e,n);t.dispatchEvent(o)};return e}function ao(t,e,n){const o=e.gateway;if(o)return o.updateTag(),o;const r=so(t,e),s=r.props;try{const{support:o}=Kn(n,e,s[0]);r.element=e,r.tag=o;const c=function(t,e,n,o){const r=no[t],s=new MutationObserver((t=>{if(function(t){const{element:e}=t;return!!document.body.contains(e)||(uo(t),!1)}(a))for(const e of t)"attributes"===e.type&&c()}));function c(){r.updateTag(n,e)}yo(o,io(o));const a={id:t,tag:n,observer:s,component:o,element:e,updateTag:c,tagGateway:r};r.gates.push(a),e.gateway=a;return s.observe(e,{attributes:!0}),a}(t,e,o,n);return e.gateway=c,c}catch(t){throw console.warn("Failed to render component to element",{component:n,element:e,props:s[0],err:t}),t}}function uo(t){const{id:e,observer:n,tag:o}=t;n.disconnect(),Rt(o,o.context.global),delete ro[e]}function io(t){return"__tagTemplate_"+function(t){let e=t.toString().replace(/\s+/g,"_").replace(/[^\w\d]/g,"_");return/^[a-zA-Z]/.test(e)||(e="fn_"+e),e}(t.original||t)}class lo extends HTMLElement{gateway;gatewayPromise=Promise.resolve();constructor(){super(),this.gatewayPromise=this.gatewayPromise.then((()=>new Promise((t=>{setTimeout((()=>{this.gateway=function(t){const e=t.gateway;let n=e?.id||t.getAttribute("tag");if(!n){const e='Tagged gateway element must have a "tag" attribute which describes which tag to use';throw console.warn(e,{element:t}),new Error(e)}if(!n){const e="Cannot check a tag on element with no id attribute";throw console.warn(e,{tagName:n,element:t}),new Error(e)}const o=no[n]?.component||ro[n]?.tagComponent;if(!o){const e=`Cannot find a tag registered by id of ${n}`;throw console.warn(e,{tagName:n,element:t}),new Error(e)}return ao(n,t,o)}(this),t()}),0)}))))}disconnectedCallback(){this.gatewayPromise.then((()=>{uo(this.gateway)}))}}const po="tag-element";function fo(){customElements.define(po,lo)}function go(t,e,n){const o=n.context.global.newest,r=(o.propsConfig,so(t,e).props);o.templater.props=r,ht.tagClosed$.toCallback((()=>{const t=n.context.global.newest;t.templater.props=r,on(t)}))}const ho=function(t){const e=io(t);if(no[e])return no[e];let n,o=0;function r(){const o=function(t,e){return function(t,e,n){return e.forEach((e=>ao(t,e,n))),e}(t,document.querySelectorAll(`[tag="${t}"]`),e)}(e,t);return o.length?(n&&clearInterval(n),o.length):o.length}const s={id:e,component:t,gates:[],propMemory:{},props:(t,e)=>mo(s,t,[e]),updateTag:(t,n)=>{go(e,n,t)}};return r()?s:(n=setInterval((()=>{if(o+=5,o>=2e3)throw clearInterval(n),new Error(`TaggedJs Element ${e} not found`);r()}),5),no[e]=s,no[e])};function mo(t,e,n){const o=t.propMemory,r=o[e]=o[e]||{props:n,callCount:0};r.props=n,++r.callCount;const{element:s,tag:c}=r;return s&&c&&t.updateTag(c,s),e}let bo=!1;function yo(t,e){if(!bo){try{fo()}catch(t){throw t}bo=!0}if(no[e])return no[e];ro[e]=ro[e]||{gates:[],tagComponent:t};const n={id:e,component:t,propMemory:{},gates:[],props:(t,e)=>mo(n,t,[e]),updateTag:(t,n)=>go(e,n,t)};return ro[e].tagComponent=t,no[e]=n,n}function wo(t){return yo(t,io(t)+"_"+performance.now())}var vo=e.TV,xo=e.xH,To=e.Ly,Co=e.TY;export{vo as classGatewayTag,xo as initWebComponents,To as loadTagGateway,Co as tagGateway};